<!DOCTYPE html>
<html lang="ja" xmlns="http://www.w3.org/1999/html">
<head>
  <meta charset="UTF-8"/>
  <meta http-equiv="Content-Type" content="text/html"/>
  <title>pgadget - hogehoge@github</title>
  <link rel="StyleSheet" href="../doc/syntaxhighlighter/styles/shCore.css" type="text/css"/>
  <link rel="StyleSheet" href="../doc/syntaxhighlighter/styles/default.css" type="text/css"/>
  <!-- link rel="StyleSheet" href="../doc/syntaxhighlighter/styles/shThemeMidnight.css" type="text/css"/ -->
  <link rel="StyleSheet" type="text/css" href="../common.css"/>
  <link rel="alternate"
        type="application/atom+xml"
        href="http://github.com/feeds/teramako/commits/teramako.github.com/master"
        title="Recent Commits to teramako.github.com:master"/>
  <link rel="alternate"
        type="application/atom+xml"
        href="http://github.com/feeds/teramako/commits/pgadget/master"
        title="Recent Commits to pgadget:master"/>
  <script type="text/javascript" src="../js/jquery-1.3.2.min.js"></script>
  <script type="text/javascript" src="../js/github.js"></script>
  <script type="text/javascript" src="../js/util.js"></script>
  <script src="../doc/syntaxhighlighter/scripts/shCore.js" type="text/javascript"></script>
  <script src="../doc/syntaxhighlighter/scripts/shBrushMozJS.js" type="text/javascript"></script>
  <script src="../doc/syntaxhighlighter/scripts/shBrushXml.js" type="text/javascript"></script>
  <script src="../doc/syntaxhighlighter/scripts/shBrushCss.js" type="text/javascript"></script>
</head>
<body>
<h1><a href="../index.html"><img src="../logo.svg" width="301" height="150" alt="hogehoge" /></a></h1>

<p><a href="http://github.com/teramako/pgadget/tree/master">Repository</a></p>
<navi>
  <ol>
    <li><a href="../index.html">Top</a></li>
    <li>pgadget</li>
  </ol>
</navi>
<article>
  <hgroup style="width: 72%;">
    <h2>pgadget</h2>
    <p>Panorama Gadget for Firefox 4</p>
  </hgroup>
  <navi class="sidebar">
    <h2>Contents</h2>
    <ul>
      <li><a href="#whatisthis">これは何？</a></li>
      <li><a href="#howtouse">使い方</a></li>
      <li><a href="#terms">用語</a></li>
      <li><a href="#whowto">ガジェットの作り方</a></li>
    </ul>
    <h2>Commits History</h2>
    <ul class="history" project="pgadget" branch="master" maxcount="5"></ul>
  </navi>

  <p id="diagram_1" title="パノラマ 1" class="img" style="width:72%;">
    <img src="pgadget-1.png"/>
  </p>
  <section id="whatisthis">
    <h3>これは何？</h3>
    <p>Firefox 4 の Panorama 上にガジェットを置くことを可能にする拡張機能。</p>
    <p>1ファイル1ガジェットとして<a href="#gadget_dir">特定のディレクトリ</a>にJavaScriptファイルを置くことで動作するフレームワーク的な存在。</p>
    <p>要するにGreasemonkeyの様な存在であって実際に動かすには別スクリプトが必要ってこと。</p>
  </section>
  <section id="howtouse">
    <h3>使い方</h3>
    <p>パノラマを開くと右隅に一つボタン画像が現れます。(<a href="#diagram_1">図1</a>)
    このボタンをクリックすると全体が暗くなり、使用可能なガジェットのリストと現在のステータスが表示されます。(<a href="#diagram_2">図2</a>)
    </p>
    <p id="diagram_2" class="img" title="ガジェット・リスト" style="float:right;">
      <img src="pgadget-2.png" width="600"/>
    </p>
    <p>
    最初は全て非表示です。リスト内のボタンをクリックすることで表示/非表示のトグルが可能です。また、リスト外をクリックすることでリストの管理モードを解除できます。
    </p>
    <p>
      また、<a href="#gadget_file">ガジェット・ファイル</a>をドラッグ&amp;ドロップすることで、そのファイルをガジェットとして読み込ませることができます。
    </p>
    <p>
      各ガジェットは以下の様な事が可能です。
    </p>
    <ul>
      <li>タイトル部をドラッグで移動</li>
      <li>タイトル部をダブルクリックで折り畳み/展開のトグル</li>
      <li>右上隅の×ボタンでクローズ</li>
      <li>右下隅のドラッグでリサイズ</li>
    </ul>
  </section>
  <section id="terms">
    <h3>用語</h3>
    <dl>
      <dt id="gadget">Gadget (ガジェット)</dt>
      <dd>
        <p>フレームワークが用意するインスタンス。</p>
        <p>ガジェットの格子となる、タイトルやコンテンツ、クローズボタン、リサイズボタン等を有する。</p>
        <p>また、<a href="#gadget_file">ガジェット・ファイル</a>を内部で読み込んで<code><var>item</var></code>プロパティに持っている。</p>
      </dd>
      <dt id="gadget_file">Gadget file (ガジェット・ファイル)</dt>
      <dd>
        <p>ガジェットのコンテンツとなる変数や関数が定義されたJavaScriptファイル。</p>
      </dd>
      <dt id="gadget_dir">Gadget directory (ガジェット・ディレクトリ)</dt>
      <dd>
        <p>
          <tt class="file"><var title="プロファイルディレクトリ">ProfD</var>/pgadget/</tt>
        </p>
        <p>このディレクトリ以下にガジェット・ファイルを置くとパノラマ起動時に読み込まれ、ガジェットとして使用可能になる。</p>
      </dd>
    </dl>
  </section>
  <section id="howto">
    <h3>ガジェットの作り方</h3>
    <p>
      JavaScriptで<a href="#gadget_file">ガジェット・ファイル</a>を作成します。
      基本的に特定の変数・関数を定義することで、フレームワーク側が読み取って実行する形になっています。
    </p>

    <navi class="sidebar">
      <h4>Index</h4>
      <ul>
        <li><a href="#basic">基本</a></li>
        <li><a href="#variables">意味のある変数</a></li>
        <li><a href="#functions">意味のある関数</a></li>
        <li><a href="#dynamic-contents">動的コンテンツ</a></li>
      </ul>
    </navi>

    <section id="basic">
      <hgroup>
        <h4>基本</h4>
        <p><a href="#code_1">下記コード</a>を基に基本的な書き方を説明します。</p>
      </hgroup>
      <pre class="brush: mozjs" title="Sample" id="code_1">
        var id = "sample-1"; // 必須
        var title = "Sample Gadget"; // ガジェットのタイトル

        // ガジェットのコンテンツ部
        var xml = <div>
          <p>This is a sample gadget.</p>
        </div>;

        // CSS設定
        var css = <css>&lt;![CDATA[
          #sample-1 p {
            color: red;
          }
        ]]&gt;</css>.toString();
      </pre>
      <p>まず、一意に定まる<code><var>id</var></code>変数を定義する必要があります。これはガジェットの要素の<dfn class="attr">id</dfn>属性となり、必須です。</p>
      <p><code><var>title</var></code>はガジェットのタイトル部を、<code><var>xml</var></code>はガジェットのコンテンツ部へ挿入される<dfn title="Ecmascript for XML">E4X</dfn>を記述します。</p>
      <p>
        必要であれば、<code><var>css</var></code>変数に<dfn>CSS</dfn>文字列を定義することででスタイルを設定することも可能です。この際、<dfn class="attr">id</dfn>属性となる<code><var>id</var></code>の値を付けておくと、そのガジェットのみに適応するスタイルにすることができます。できるだけ付けることを推奨します。
      </p>
      <p>静的なガジェットであればこれで完成です。</p>
    </section>

    <section id="variables">
      <hgroup>
        <h4>意味のある変数</h4>
        <p>定義するとフレームワーク側で処理される変数を以下に示します。(<a href="#table_1">表1</a>)</p>
      </hgroup>
      <table id="table_1">
        <caption>意味のある変数</caption>
        <tr>
          <th>変数名</th><th>型</th><th>説明</th>
        </tr>
        <tr>
          <td>id</td>
          <td>string</td>
          <td>ガジェットのIDとなる。また、ガジェットの要素の<dfn class="attr">id</dfn>属性値にもなる。</td>
        </tr>
        <tr>
          <td>title</td>
          <td>string</td>
          <td>ガジェットのタイトル</td>
        </tr>
        <tr>
          <td>xml</td>
          <td>xml</td>
          <td>ガジェットのコンテンツとなる。<dfn title="Ecmascript for XML">E4X</dfn>で記述。</td>
        </tr>
        <tr>
          <td>css</td>
          <td>string</td>
          <td>スタイルを定めるCSS文字列</td>
        </tr>
        <tr>
          <td>rect</td>
          <td>object</td>
          <td>初期表示位置、大きさを定めるオブジェクト。<br/>
            <code>top</code>,<code>bottom</code>,<code>left</code>,<code>right</code>,<code>width</code>,<code>height</code>にピクセル値を入れる。
            <pre class="brush: mozjs" title="example">
              var rect = {
                top: 10,
                left: 10,
                width: 250,
                height: 200
              };
            </pre>
          </td>
        </tr>
        <tr>
          <td>draggable</td>
          <td>boolean</td>
          <td>ドラッグの可否。初期値は<code>true</code></td>
        </tr>
        <tr>
          <td>closeable</td>
          <td>boolean</td>
          <td>クローズの可否。初期値は<code>true</code></td>
        </tr>
        <tr>
          <td>resizable</td>
          <td>boolean</td>
          <td>リサイズの可否。初期値は<code>true</code></td>
        </tr>
      </table>
    </section>

    <section id="functions">
      <hgroup>
        <h4>意味のある関数</h4>
        <p>定義するとフレームワーク側で適時呼び出される関数を以下に示します。(<a href="#table_2">表2</a>)</p>
      </hgroup>
      <table id="table_2">
        <caption>意味のある関数</caption>
        <tr>
          <th>関数名</th><th>説明</th>
        </tr>
        <tr>
          <td>onLoad</td>
          <td>ガジェットが表示される時に呼び出されます</td>
        </tr>
        <tr>
          <td>onUnload</td>
          <td>ガジェットがクローズされる時に呼び出されます</td>
        </tr>
        <tr>
          <td>onShown</td>
          <td>パノラマが表示された時に呼び出されます</td>
        </tr>
        <tr>
          <td>onHidden</td>
          <td>パノラマが閉じるときに呼び出されます</td>
        </tr>
      </table>
    </section>

    <section id="gadget_context">
      <hgroup>
        <h4>既定の変数/関数</h4>
        <p>ガジェット・ファイルの実行コンテキストに容易される変数/関数</p>
      </hgroup>
      <p>ガジェット・ファイルのコードが実行されるコンテキストは通常のHTMLドキュメントに置く<code>&lt;script ...&gt;</code>のようなコンテキストとは異なり、それぞれ特殊なオブジェクト上で実行されます。</p>
      <p>そのオブジェクトには以下のような変数が定義されています。(<a href="#table_3">表3</a>)</p>
      <p>また、コンテキストの概要は<a href="object-tree.html">Object tree</a>を参照してください。</p>
      <table id="table_3">
        <caption>ガジェット・ファイルのコンテキストで既定の変数</caption>
        <tr>
          <th>変数名</th>
          <th>型</th>
          <th>説明</th>
        </tr>
        <tr>
          <td>__FILE__</td>
          <td>object (nsIFile)</td>
          <td>ガジェット・ファイルそのもの</td>
        </tr>
        <tr>
          <td>gadget</td>
          <td>object</td>
          <td>ガジェットのインスタンス</td>
        </tr>
        <tr>
          <td>gadget.item</td>
          <td>object</td>
          <td>ガジェット・ファイルの実行コンテキスト<br/>
            (ガジェットファイル内では <code>this === gadget.item</code>となる)</td>
        </tr>
        <tr>
          <td>gadget.rootElm</td>
          <td>object (Element)</td>
          <td>ガジェットのルートの要素</td>
        </tr>
        <tr>
          <td>gadget.titleElm</td>
          <td>object (Element)</td>
          <td>ガジェットのタイトル部分の要素</td>
        </tr>
        <tr>
          <td>gadget.contentElm</td>
          <td>object (Element)</td>
          <td>ガジェットのコンテンツ部分の要素</td>
        </tr>
      </table>
    </section>
    <section id="dynamic-contents">
      <h4>動的なコンテンツ</h4>
      <p>変数と同じく、特定の名前で関数を定義するとフレームワーク側から適時実行されます。</p>
      <pre class="brush: mozjs; first-line: 15;" title="Sample 続き" id="code_2">
        // 初期化時に実行される
        function onLoad () {
          alert("initialized: " + gadget.id);
        }
        // 初期化後とパノラマ表示時に実行される
        function onShown () {
          alert("onShown: "  + gadget.id);
        }
      </pre>
      <p>
      </p>
    </section>
  </section>
</article>
<div id="footer">
  <hr/>
  <p><a href="../index.html">Index</a></p>
</div>
</body>
<script type="text/javascript">
SyntaxHighlighter.defaults["gutter"] = true;
SyntaxHighlighter.defaults["auto-links"] = false;
SyntaxHighlighter.defaults["toolbar"] = false;
SyntaxHighlighter.defaults["tab-size"] = 2;
SyntaxHighlighter.all()
</script>
<script type="text/javascript">
  $(".history").each(function(index, elm){
    var count = elm.hasAttribute("maxcount") ? parseInt(elm.getAttribute("maxcount"),10) : 0;
    var g = GITHUB("commits", {
      user: "teramako",
      project: elm.getAttribute("project"),
      branch: elm.getAttribute("branch") || "master",
      target: elm
    });
    var ul = $(elm);
    g.getCommitsListForBranch(function(commit){
      if (count > 0) commit = commit.slice(0, count);
      $.each(commit, function(i, commit){
        ul.append([
          '<li>',
          '<span class="git-date">',
          formatDate(toDateFromw3cDateString(commit.committed_date), "%F %T"),
          '</span><br/>',
          '<a href="https://github.com', commit.url, '">', commit.message, '</a></li>'
        ].join(""));
      });
    });
  });
</script>
</html>
<!--
vim:sw=2 ts=2 et:
-->
